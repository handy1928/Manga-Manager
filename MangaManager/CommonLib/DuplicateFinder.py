# encoding ut
import argparse
import json
import os
import re
from difflib import SequenceMatcher
from itertools import combinations

from CommonLib.ProgressBarWidget import ProgressBar

dirs = ["aaa/aaa", "b//bbb", "aaaa", "aaa", "bbb", "aaaa", "aaa", "bbb", "aaaa", "aaa", "bbb", "aaaa", "aaa", "bbb",
        "aaaa", "aaa", "bbb", "aaaa"]
# dirs = ['Maseki Gourmet Mamono no Chikara wo Tabeta Ore wa Saikyou', '100-nin no Eiyuu wo Sodateta Saikyou Yogensha wa Boukensha ni Natte mo Sekaijuu no Deshi kara Shitawaretemasu comic', '6-sai no Kenja wa Hikage no Michi wo Ayumitai', 'A Rank Party wo Ridatsu Shita Ore wa Moto Oshiegotachi to Meikyuu Shinbu wo Mezasu', 'A-Rank Boukensha no Slow Life', 'A.I.C.O. Incarnation', 'Akai Ringo', 'Akuyaku Reijou Level 99 Watashi wa Ura Boss desu ga Maou de wa Arimasen', 'An Active Hunter in Hokkaido Has Been Thrown into a Different World', 'Ansatsu Skill de Isekai Saikyou Renkinjutsu to Ansatsujutsu wo Kiwameta Ore wa Sekai wo Kage kara Shihai suru', 'Ningen Fushin no Boukensha-tachi ga Sekai wo Sukuu you desu', 'Ninkyou Tensei Isekai no Yakuza-hime', 'Nise Seiken Monogatari Osananajimi no Seijo o Uttara Michizure ni Sareta', 'Nito no Taidana Isekai Shoukougun', 'Noumin Kanren no Skill Bakka Agetetara Naze ka Tsuyoku Natta', 'Nozomanu Fushi no Boukensha', 'Only Sense Online', 'Ore no Ie ga Maryoku Spot datta Ken - Sundeiru dake de Sekai Saikyou', 'Ore no Ie ga Maryoku Spot Datta Ken Sundeiru dake de Sekai Saikyou', 'Ore no Zense no Chishiki de Teihenshoku Tamer ga Joukyuushoku ni Natte Shimaisou na Ken', 'Ore wa Seikan Kokka no Akutoku Ryoushu', 'Kaichou wa Maid-sama', 'Kaifuku Jutsushi no Yarinaoshi', 'Kaiko sareta Ankoku Heishi 30-dai no Slow na Second Life', 'Kajiya de Hajimeru Isekai Slow Life', 'Kami no Techigai de Shindara Cheat Gun Zumi de Isekai ni Hourikomaremashita', 'Kamigami ni Sodaterare Shimo no, Saikyou to Naru', 'Kamitachi ni Hirowareta Otoko', 'Kanchigai no Atelier Meister Eiyuu Party no Moto Zatsuyougakari ga Jitsu wa Sentou Igai ga SSS Rank Datta to Iu Yoku Aru Hanashi', 'Kanzen Kaihi Healer no Kiseki', 'Kawaii dake ja Nai Shikimori-san', 'Keikenchi Chochiku de Nonbiri Shoushin Ryokou Yuusha to Koibito ni Tsuihou sareta Senshi no Mujikaku zama', 'Kekkaishi e no Tensei', 'Kenja no Deshi wo Nanoru Kenja THE COMIC', 'Gate Jieitai Kanochi nite Kaku Tatakaeri', 'Genjitsu Shugi Yuusha no Oukoku Saikenki', 'Genjitsushugi Yuusha no Oukoku Saikenki', 'Genkai Koe no Skill wa Tenseisha ni Shika Atsukaenai Over Limit Skill Holder', 'Genkai Level 1 kara no Nariagari Saijaku Level no Ore ga Isekai Saikyou ni Naru made', 'Gokufuri Kyohi shite Tesaguri Start Tokka shinai Healer Nakama to Wakarete Tabi ni Deru', 'Gokushufudou', 'Goshujin-sama to Yuku Isekai Survival THE COMIC', 'Gotou-san wa Furimukasetai', 'Hachi-nan tte Sore wa Nai deshou', 'Shin no Jitsuryoku wa Girigiri Made Kakushite Iyou to Omou', 'Shin no Nakama janai to Yuusha no Party', 'Shin no Nakama janai to Yuusha no Party wo Oidasareta node Henkyou de Slow Life suru Koto ni shimashita', 'Shindou Sephilia no Gekokujou Program', 'Shingan no Yuusha', 'Shinjiteita Nakamatachi ni Dungeon Ouchi de Korosarekaketa ga Gift Mugen Gacha de Level 9999 no Nakamatachi wo Te ni Irete Moto Party Member to Sekai ni Fukushuu Zamaa Shimasu', 'Shinka no Mi Shiranai Uchi ni Kachigumi Jinsei', 'Shitsugyou Kenja no Nariagari Kirawareta Sainou wa Sekai Saikyoudeshita', 'Arafoo Kenja no Isekai Seikatsu Nikki', 'Boku no Kawaii Musume wa Futago no Kenja', 'Dorei Shounin shika Sentakushi ga nai desu yo ~Harem Nani sore oishii no~', 'Enzai de Shokei Sareta Koushaku Reijou wa Konse de wa Mofu Kami-sama to Odayaka ni Sugoshitai', 'Game obu Familia - Family Senki', 'Hai Gamer na Imouto to Hajimeru VRMMO Seikatsu', "I Was Dismissed from the Hero’s Party Because They Don't Need My Training Skills", 'Isekai Cheat Magic Swordsman', 'Isekai Meikyuu no Saishinbu wo Mezasou', 'Kage no Jitsuryokusha ni Naritakute', 'Kenja no Mago', 'Kouritsuchuu Madoushi Daini no Jinsei de Madou wo Kiwameru', 'Kyoukai Meikyuu to Ikai no Majutsushi', 'Makikomarete Isekai Teni suru Yatsu wa Taitei Cheat', 'The Hero Who Seeks Revenge Shall Exterminate with Darkness', "The Most Notorious Talker Runs the World's Greatest Clan", 'The New Gate', 'The NPCs in this Village Sim Game Must Be Real!', 'The Reincarnation Magician of the Inferior Eyes', 'The Rising Of The Vibrator Hero', "The Saint's Magic Power Is Omnipotent", 'The Strongest Sage with the Weakest Crest', "The Unsuccessful yet Academically Unparalleled Sage ~A Cheating S-Rank Sorcerer's Post-Rebirth Adventurer Log~", 'The Useless Tamer Will Turn into the Top Unconsciously by My Previous Life Knowledge', 'Isekai de Cheat Skill wo Te ni Shita Ore wa Genjitsu Sekai wo mo Musou Suru Level Up wa Jinsei wo Kaeta', 'Isekai de Kojiin wo Hiraita kedo Naze ka Darehitori Sudatou to Shinai Ken', 'Isekai de Skill wo Kaitai shitara Cheat na Yome ga Zoushoku Shimashita Gainen Kousa no Structure', 'Isekai de Slow Life wo Ganbou', 'Isekai Elf no Dorei-chan', 'Isekai Kaeri no Yuusha ga Gendai Saikyou', 'Isekai Kenja no Tensei Musou ~Geemu no Chishiki de Isekai Saikyou~', 'Isekai Kenkokuki', 'Isekai Maou to Shoukan Shoujo no Dorei Majutsu', 'Isekai Meikyuu de Harem wo', 'Saikyou Degarashi Ouji no Anyaku Teii Arasoi', 'Saikyou no Madoushi Hiza ni Ya wo Ukete Shimatta no de Inaka no Eihei ni Naru', 'Saikyou no Shien-shoku Wajutsushi Dearu Ore wa Sekai Saikyou Clan wo Shitagaeru', 'Saikyou no Shokugyou wa Yuusha demo Kenja demo Naku Kanteishi Kari Rashii desu yo', 'Saikyou Shoku Ryukishi kara Shokyu Shoku Hakobiya ni Natta no ni Naze ka Yushatachi kara Tayoraretemasu comic', 'Salaryman ga Isekai ni Ittara Shitennou ni Natta Hanashi', 'Save Load no Dekiru Yadoya-San', 'LEGEND', 'Level 1 no Saikyou Kenja Noroi de Saikakyuu Mahou shika Tsukaenaikedo Kami no Kanchigai de Mugen no Maryoku o Te ni Ire Saikyou ni', 'Liar Satsuki Can See Death', 'Love Hina', 'Lv2 Kara Cheat datta Moto Yuusha Kouho no Mattari Isekai Life', 'Magi Craft Meister', 'MagicalExplorer Eroge no Yuujin Chara ni Tensei Shitakedo Game Chishiki Tsukatte Jiyuu ni Ikiru', 'Makenshi no Maken Niyoru Maken no Tame no Harem Life', 'Suterareta Tensei Kenja Mamono no Mori de Saikyou no Daima Teikoku wo Tsukuriageru', 'Suuji de Sukuu Jakushou Kokka', 'Takarakuji de 40-oku Atattanda kedo Isekai ni Ijuusuru', 'Tanaka ke Tensei Suru', 'Tate no Yuusha no Nariagari', 'Teihen Ryoushu no Kanchigai Eiyuutan Heimin ni Yasashiku Shite tara Itsuno Manika Kuni to Sensou ni Natteita Ken', 'Tenkuu no Shiro o Moratta no de Isekai de Tanoshiku Asobitai', 'Tenkuu no Shiro wo Moratta no de Isekai de Tanoshiku Asobitai', 'Tenohira Kaitaku Mura de Isekai Kenkokuki Fueteku Yome-tachi to Nonbiri Mujintou Life', 'Bokura wa Minna Kawaisou', 'Boukenka ni Narou! Skill Board de Dungeon Kouryaku', 'Boukensha License wo Hakudatsu Sareta Ossan Dakedo Manamusume ga Dekita no de Nonbiri Jinsei wo Ouka Suru', 'Cheat Kusushi no Slow Life Isekai ni Tsukurou Drugstore', 'Chichi wa Eiyuu Haha wa Seirei Musume no Watashi wa Tenseisha', 'Chiyu Mahou no Machigatta Tsukaikata Senjou wo Kakeru Kaifuku Youin', 'Chronicles of an Aristocrat Reborn in Another World', 'Class Teni de Ore dake Haburaretara node Doukyuu Harem Tsukuru Koto ni Shita', 'Cut Paste de Kono Sekai wo Ikite Iku', 'D Genesis Dungeon ga Dekite 3-nen', 'Death March Kara Hajimaru Isekai Kyousoukyoku', 'tmp', 'Toaru Ossan no VRMMO Katsudouki', 'Tora Kiss A School Odyssey', 'Tou no Kanri o Shite Miyou', 'Tou no Kanri wo Shite Miyou', 'Treat of Reincarnation The Advent of the Almighty Pastry Chef', 'Triage X', 'Tsuki ga Michibiku Isekai Douchuu', 'Unnamed Memory', 'Uragirareta S-Rank Boukensha no Ore wa Aisuru Dorei no Kanojora to Tomo ni Dorei dake no Harem Guild wo Tsukuru', 'Usotsuki Satsuki Shi ga Mieru', 'Virus Tensei kara Isekai Kansen Monogatari', 'World Teacher - Isekaishiki Kyouiku Agent', 'Ie ga Moete Jinsei Dou Demo Yoku Natta kara Nokotta Nakenashi no Kin de Dark Elf no Dorei wo Katta', 'In Another World with My Smartphone', "In Another World, I'm Called the Black Healer", 'In the Land of Leadale', 'Inaka no Home Center Otoko no Jiyuu na Isekai Seikatsu', 'Ingoku Danchi', "Isekai Affair ~Ten Years After The Demon King's Subjugation", 'Isekai Apocalypse MYNOGHRA', 'Maseki Gurume Mamono no Chikara o Tabeta Ore wa Saikyou!', 'Mato Seihei no Slave', 'Mazumeshi Elf to Yuuboku Gurashi', 'meta.py', 'Mezametara Saikyou Soubi to Uchuusen-mochi datta no de Ikkodate Mezashite Youhei Toshite Jiyuu ni Ikitai', 'Might as Well Cheat - I Got Transported to Another World Where I Can Live My Wildest Dreams!', 'Misetagari no Tsuyuno-chan', 'Mishiranu Joshikousei ni Kankinsareta Mangaka no Hanashi', 'Monster no Goshujin-sama', 'Moto Juui no Reijou wa Konyaku Hakisaremashita ga Mofumofu-tachi ni Daininki desu', 'Moto Kouzou Kaiseki Kenkyuusho no Isekai Boukentan', 'Moto Sekai 1-i no Sub Chara Ikusei Nikki Hai Player Isekai wo Kouryaku-chuu', 'Murazukuri Game no NPC ga Namami no Ningen to shika Omoenai', 'Real mo Tama ni wa Uso wo Tsuku', 'Real no Heroine wa Irimasen', 'Realist Maou ni Yoru Seiiki Naki Isekai Kaikaku', 'Realist Maou Niyoru Seiiki Naki Isekai Kaikaku', 'Rebuild World', 'Rettou Gan no Tensei Majutsushi ~ Shiitage Rareta Saikyou no Minashigo ga Isekai de Musou Suru', 'Rettou Hito no Maken Tsukai Sukiruboudo o Kushi Shite Saikyou ni Itaru', 'Rettougan no Tensei Majutsushi Shiitagerareta Moto Yuusha wa Mirai no Sekai wo Yoyuu de Ikinuku', 'Tensei Inja wa Hokusoemu', 'Tensei Kenja no Isekai Life Daini no Shokugyo wo Ete Sekai Saikyou ni Narimashita', 'Tensei Kizoku Kantei Skill de Nariagaru Jakushou Ryouchi wo Uketsuidanode Yuushuuna Jinzai wo Fuyashite Itara Saikyou Ryouchi ni Natteta', 'Tensei Kizoku no Isekai Boukenroku Jichou wo Shiranai Kamigami no Shito', 'Tensei Kyuuketsuki-san wa Ohirune ga Shitai', 'Tensei Oujo to Tensai Reijou no Mahou Kakumei', 'Tensei Reijou wa Shomin no Aji ni Uete Iru', 'Tensei Shichatta yo Iya Gomen', 'Tensei Shita Akuyaku Reijou wa Fukushuu wo Nozomanai THE COMIC', 'Tensei shita Akuyaku Reijou wa Fukushuu wo Nozomanai the Comic', 'Tensei Shitara Dragon no Tamago Datta Saikyou Igai Mezasa Nee', 'Tensei Shitara Ken Deshita', 'Tensei Shitara Slime Datta Ken', 'Tensei Shitara Warui Kuni no Musume Deshita', "The Weakest Occupation Blacksmith, but It's Actually the Strongest", "The White Mage Who Was Banished From the Hero's Party", "The World's Fastest Level Up!", 'Sekai Saikou no Ansatsusha Isekai Kizoku ni Tensei suru', 'Sekai Saikyou no Assassin, Isekai Kizoku ni Tensei Suru', 'Sekai Saikyou no Kouei Meikyuukoku no Shinjin Tansakusha', 'Sekai Saisoku no Level Up', 'Sekkaku Cheat wo Moratte Isekai ni Teni shita n dakara Suki na You ni Ikitemitai The Comic', 'Sen no Skill wo Motsu Otoko Isekai de Shoukanjuu Hajimemashita', 'Senki to Yobareta Otoko Ouke ni Ansatsu saretara Musume wo Hiroi Issho ni Slow Life wo Hajimeru Innocent Days', 'Senki to Yobareta Otoko, Ouke ni Ansatsu Saretara Musume wo Hiroi, Issho ni Slow Life wo Hajimeru', 'Sensei Ore ni Kamawazu Itte Kudasai', 'Sensei, Ore ni Kamawazu Itte Kudasai!!', 'She Professed Herself Pupil of the Wise Man', 'Shijou Saikyou no Daimaou Murabito A ni Tensei suru', 'Shijou Saikyou no Mahou Kenshi F Rank Boukensha ni Tensei Suru Kensei to Matei 2-tsu no Zense wo Motta Otoko no Eiyuutan', 'Shijou Saikyou Orc-san no Tanoshii Tanetsuke Harem-Zukuri', 'Shikkakumon no Saikyou Kenja Sekai Saikyou no Kenja ga Sarani Tsuyoku Naru Tame ni Tensei Shimashita', 'Wortenia Senki', 'Yakutatazu Skill ni Jinsei wo Sosogikomi 25-nen Imasara Saikyou no Boukentan', 'Yankee JK KuzuHana-chan', 'Yankee JK Kuzuhana-chan', 'Yankee wa Isekai de Seirei ni Aisaremasu', 'Yonshimai Elf wa Yoru wo Omachikane', 'Youkoso Jitsuryoku Shijou Shugi no Kyoushitsu e', 'Yuukyuu no Gusha Asley no Kenja no Susume to Pochi no Daibouken', 'Yuusha Party ni Kawaii Ko ga Ita no de Kokuhaku Shitemita', 'Yuusha Party ni Kawaii Ko ga Ita no de, Kokuhaku Shite Mita', 'Yuusha Party wo Tsuihou Sareta Beast Tamer, Saikyou Shu Nekomimi Shojo to Deau', 'Yuusha Party wo Tsuihou Sareta Shiromadoushi S Rank Boukensha ni Hirowareru Kono Shiromadoushi ga Kikakugai Sugiru', 'Yuusha Shoutai Kamoku Yuush wa Nagasarenai', 'Yuusha Yamemasu', 'Zennin Ossan Umarekawattara SSS Rank Jinsei ga Kakutei Shita', 'Zennin Ossan, Umarekawattara SSS Rank Jinsei ga Kakutei Shita', 'Zense wa Kentei Konjou Kuzu Ouji', 'Zettai ni Yatte wa Ikenai Isekai Shoukan', '^C', 'Dorei Tensei Sono Dorei Saikyou no Moto Ouji ni Tsuki', 'Doukutsuou kara Hajimeru Rakuen Life Bannou no Saikutsu Skill de Saikyou Ni', 'Douyara Watashi no Karada wa Kanzen Muteki no You desu ne', 'Dungeon Kurashi no Moto Yuusha THE COMIC', 'E-Rank no Kusurishi', 'Eiyuu-ou Bu wo Kiwameru Tame Tenseisu Soshite Sekai Saikyou no Minarai Kishi', 'Haikei Koroshiya-san to Kekkon Shimashita', 'Hakoniwa no Kusuri-jutsu-shi Kamisama ni Aisare Joshi no Isekai Seikatsu', 'Hanaukyo Maid-tai', 'Handyman Saitou In Another World', 'Hazure Akamadoushi ha Kenjyatime ni Musou suru', 'Hazure Skill Kage ga Usui o Motsu Guild Shokuin ga, Jitsu wa Densetsu no Ansatsusha', 'Hazure Waku no Joutai Ijou Skill de Saikyou ni Natta Ore ga Subete wo Juurin Suru made', 'Hell Mode Yarikomi Suki no Gamer wa Haisettei no Isekai de Musou Suru - Hajimari no Shoukanshi', 'Hero in White Coat', 'Himekishi ga Classmate THE COMIC', 'Hiraheishi wa Kako wo Yumemiru', 'Hitoribocchi no Isekai Kouryaku', 'Hokkaidou no Geneki Hunter ga Isekai ni Hourikoma Rete Mita Elf Yome to Meguru Isekai Shuryou Life', 'Homeless Tensei Isekai De Jiyuu Sugiru Majutsu Jisoku Seikatsu', 'I Am A Killer Maid', "It's That Reincarnated-as-a-Virus Story", 'Itai no wa Iya nano de Bougyoryoku ni Kyokufuri Shitai to Omoimasu', 'Itoshi no Sakura-san', 'Itsudemo Jitaku ni Kaerareru Ore wa Isekai de Gyoushounin wo Hajimemashita', 'Jaryuu Tensei', 'Jichou Shinai Motoyuusha no Tsuyokute Tanoshii New Game', 'Jigoku no Gouka de Yakare Tsuzuketa Shounen Saikyou no Honou Tsuka to Natte Fukkatsu Suru', 'Jimi na Kensei Soredemo Saikyou desu', 'Jitsu wa Ore Saikyou Deshita', 'Kage no Eiyuu no Nichijou Tan Yuusha no Ura de Anyaku Shiteita Saikyou no Agent Soshiki ga Kaitai Sareta no de Shoutai Kakushite Hitonami no Nichijou wo Ouka Suru', 'Kensei no Osananajimi ga Pawahara de Ore ni Tsuraku Ataru node Zetsuen shite Henkyou de Makenshi toshite Denaosu Koto ni Shita', 'Kenshi wo Mezashite Nyuugaku Shitanoni Mahou Tekisei 9999 Nan desu kedo', 'Kikan shita Yuusha no Gojitsudan', 'Kinsou no Vermeil Gakeppuchi Majutsushi wa Saikyou no Yakusai to Mahou Sekai wo Tsuki Susumu', 'Kizoku Tensei Megumareta Umare kara Saikyou no Chikara wo Eru', 'Knights & Magic', 'Knights Magic', 'Kojiin Tamer', 'Koko wa Ore ni Makasete Saki ni Ike to Itte kara 10 Nen ga Tattara Densetsu ni Natteita', 'Konjiki no Word Master Yuusha Yonin ni Makikomareta Unique Cheat', 'Kono Kaisha ni Suki na Hito ga Imasu', 'Kono Sekai ga Game dato Ore dake ga Shitte Iru', 'Kono Yuusha ga Ore Tueee Kuse ni Shinchou Sugiru', 'Kouchuugun Shikan Boukensha ni Naru', 'Isekai Mokushiroku Mynoghra Hametsu no Bunmei de Hajimeru Sekai Seifuku', 'Isekai ni Kita Boku wa Kiyoubinbode Subayasa Tayorina Tabi wo Suru', 'Isekai ni Tobasareta Ossan wa Doko e Iku', 'Isekai Nonbiri Nouka', 'Isekai NTR Shinyuu no Onna wo Saikyou Skill de Otosu Houhou', 'Isekai Saikyou no Daimaou Tensei Shi Boukensha ni Naru', 'Isekai Shikkaku', 'Isekai Shoukan wa Nidome desu', 'Isekai Tenishita node Cheat wo Ikashite Mahou Kenshi Yaru Koto ni Suru', 'Isekai Tensei Soudouki', 'Isekai wa Smartphone to Tomo ni', 'Isekai Yakkyoku', 'Isekai Yururi Kikou Kosodate Shinagara Boukensha Shimasu', 'Manuke na FPS Player ga Isekai e Ochita Baai', 'Maou Gakuen no Hangyakusha Jinrui Hatsu no Maou Kouho Kenzoku Shoujo to Ouza wo Mezashite Nariagaru', 'Maou Gun Saikyou no Majutsushi wa Ningen datta', 'Maou ni Natta node Dungeon Tsukutte Jingai Musume to Honobono suru', 'Maou no Musume Sugoku Choroi', 'Maou no Ore ga Dorei Elf wo Yome ni Shitanda ga Dou Medereba Ii', 'Maou Toubatsu Shita Ato Medachitakunai node Guild Master ni Natta', 'Maou-sama no Machizukuri Saikyou no Dungeon wa Kindai Toshi', 'Maou-sama no Machizukuri! ~Saikyou no Dungeon wa Kindai Toshi~', 'Maou-sama Retry R', 'Maou-sama, Retry', 'Shokubutsu Monster Musume Nikki Seijo datta Watashi ga Uragireta Hate ni Aruraune ni Tensei shite shimatta node kore kara wa Kougousei wo Shinagara Shizuka ni Shoukubutsu Life ni Sugoshimasu', 'Shoukan Sareta Kenja wa Isekai wo Yuku Saikyou nano wa Fuyou Zaiko no Item Deshita', 'Shuumatsu no Harem Fantasia Gakuen', 'Slime Taoshite 300-nen, Shiranai Uchi ni Level MAX ni Nattemashita', 'Slow Life In Another World (I Wish!)', 'Sokushi Cheat ga Saikyou Sugite Isekai no Yatsura ga Marude Aite ni Naranai n desu ga --', 'Someday Will I Be the Greatest Alchemist', 'Sono Monban Saikyou Nitsuki Tsuihou Sareta Bougyo Ryoku 9999 no Senshi Outo no Monban Toshite Musou suru', 'Mushoku Tensei Isekai Ittara Honki Dasu', 'Rakudai Kenja no Gakuin Musou Nidome no Tensei S-Rank Cheat Majutsushi Boukenroku', 'Sayounara Ryuusei Konnichiwa Jinsei', 'Sekai no Owari no Encore', 'Shikkoku Tsukai no Saikyou Yuusha', 'Shoki Skill ga Benri Sugite Isekai Seikatsu ga Tanoshisugiru!', 'Souda Baikoku shiyou Tensai Ouji no Akaji Kokka Saisei Jutsu', 'Tensei Shite High Elf ni Narimashita ga Slow Life wa 120-nen de Akimashita', 'The Hero Is Overpowered But Overly Cautious', 'The Way of the Househusband', "Even Though I'm a Former Noble and a Single Mother, My Daughters Are Too Cute and Working as an Adventurer Isn’t Too Much of a Hassle", 'Fuguushoku to Baka ni Saremashita ga Jissai wa Sore Hodo Waruku Arimasen', 'Fukushuu wo Koinegau Saikyou Yuusha wa Yami no Chikara de Senmetsu Musou suru', 'Futoku no Guild', 'Fuufu Ijou Koibito Miman', 'Gacha wo Mawashite Nakama wo Fuyasu Saikyou no Bishoujo Gundan wo Tsukuriagero', 'Gaikotsu Kishi-sama Tadaima Isekai e Odekakechuu', 'Koushaku Reijou no Tashinami', 'Kujibiki Tokushou Musou Harem-ken', 'Kujonin', 'Kuro no Shoukanshi', 'My Gift Lvl 9999 Unlimited Gacha', 'My Lovey-Dovey Wife is a Stone-Cold Killer', 'Nankoufuraku no Maou-jou e Youkoso Debuff wa Fuyou to Yuusha Party wo Oidasareta Kuro Madoushi Maou-gun no Saikou Kanbu ni Mukaerareru', 'NEET dakedo Hello Work ni Ittara Isekai ni Tsuretekareta', 'NEET de Otaku na Kunoichi to Naze ka Dousei Hajimemashita', 'Netoge no Yome wa Onnanoko ja Nai to Omotta', 'Nido Tensei Shita Shounen wa S Rank Boukensha Toshite Heion ni Sugosu Zense ga Kenja de Eiyuu Datta Boku wa Raise de wa Jimi ni Ikiru', 'NieR Automata YoRHa Shinjuwan Kouka Sakusen Kiroku', 'Tensei Shite Inaka de Slowlife wo Okuritai', 'Tensei-saki ga Zannen Ouji Datta Ken Ima wa Fukkin 1-kai mo Dekinai kedo Yasete Isekai Sukuimasu ', 'Tenseishichatta yo (Iya, Gomen)', 'Tenshi na Tenkousei-chan to Kyonyuu Kyoufushou-kun', 'Tenshoku no Shinden wo Hirakimashita', 'Tenshou shita Dai Seijo wa Seijo de Aru Koto wo Hita Kakusu', 'Tensura Nikki Tensei Shitara Slime Datta Ken', 'The Angelic Transfer Student and Mastophobia-kun', 'The Galactic Navy Officer Becomes an Adventurer', 'Argate Online', 'Arifureta Shokugyou de Sekai Saikyou', 'Attouteki Gacha Un de Isekai wo Nariagaru', 'Benriya Saitou-san Isekai ni Iku', 'Bijo to Kenja to Majin no Ken', 'Binbou Reijou no Kanchigai Seijo Den', 'Black na Kishidan no Dorei ga White na Boukensha Guild ni Hikinukarete S-Rank ni Narimashita', 'Risou no Himo Seikatsu', 'Rougo ni Sonaete Isekai de 8-manmai no Kinka wo Tamemasu', 'S Rare Soubi no Niau Kanojo', 'S-Rank Boukensha de Aru Ore no Musumetachi wa Juudo no Father-con Deshita', 'Sacchi Sarenai Rule Breaker', 'Saigo ni Hitotsu dake Onegai Shite mo Yoroshii Deshou ka', 'Saihate no Paladin', 'Saijaku Tamer wa Gomi Hiroi no Tabi wo Hajimemashita', 'Oroka na Tenshi wa Akuma to Odoru', 'Ossan Boukensha Kane no Zenkou', 'Oujo Denka wa Oikari no You desu', 'Oukoku e Tsuzuku Michi Dorei Kenshi no Nariagari Eiyuutan', 'Ouritsu Mahou Gakuen no Saikasei', 'Ouritsu Mahou Gakuen no Saikasei Hikongai Agari no Saikyou Mahoushi Kizoku Darake no Gakuen de Musou Suru', 'Overlord', 'Pandora Hearts', 'Party kara Tsuihou sareta Sono Chiyushi Jitsu wa Saikyou ni Tsuki', 'SE', 'Seichou Cheat de Nandemo Dekiru you ni Natta ga Mushoku dake wa Yamerarenai you desu', 'Seikon no Qwaser (Scanlated)', 'Seirei Gensouki', 'Seirei-tachi no Rakuen to Risou no Isekai Seikatsu', 'Sekai de Tadahitori no Mamono Tsukai Tenshoku Shitara Maou ni Machigawaremashita']
# excluded_dirs = ["Maou-sama, Retry", "Maou-sama Retry R"]

progressbar = None
dirs = []
excluded_dirs = []

UPPERCASE_REGEX = re.compile(r'[A-Z]')


def compare(file_names_list, ratio):
    results = {}
    prev_a = None
    for a, b in combinations(file_names_list, 2):
        if prev_a != a:
            prev_a = a
            progressbar.increaseCount()

        if a in excluded_dirs:
            continue
        match_ratio = SequenceMatcher(None, a, b).ratio()
        if match_ratio > ratio and match_ratio != 1.0:
            results[str(match_ratio)] = {}
            results[str(match_ratio)]["pair"] = {}
            results[str(match_ratio)]["pair"]["a"] = {}
            results[str(match_ratio)]["pair"]["a"]["name"] = a
            results[str(match_ratio)]["pair"]["b"] = {}
            results[str(match_ratio)]["pair"]["b"]["name"] = b
    progressbar.increaseCount()
    # progressbar.send_final_message("All names compared with each other")
    return results


def calculate(dictionary):
    char_list = ["(", ")", ",", "~", "!", "-"]
    for ratio in dictionary:
        a = dictionary[ratio]["pair"]["a"]
        b = dictionary[ratio]["pair"]["b"]
        a["weight"] = 0
        b["weight"] = 0
        for char in char_list:
            if char in a["name"] and char not in b["name"]:
                a["weight"] += 10
            if char in b["name"] and char not in a["name"]:
                b["weight"] += 10
            if "the comic" in a["name"].lower() and "the comic" not in b["name"].lower():
                a["weight"] -= 10
            if "the comic" in b["name"].lower() and "the comic" not in a["name"].lower():
                b["weight"] -= 10
            if UPPERCASE_REGEX.findall(a["name"]) > UPPERCASE_REGEX.findall(b["name"]):
                a["weight"] += 5
            elif UPPERCASE_REGEX.findall(a["name"]) < UPPERCASE_REGEX.findall(b["name"]):
                b["weight"] += 5
        dictionary[ratio]["pair"]["master"] = a["name"] if a["weight"] < b["weight"] else b["name"]
    return dictionary


def main(dirs):
    result = compare(dirs, 0.7)
    print(json.dumps(result, sort_keys=True, indent=4))
    print(result)
    # result = {'0.9557522123893806': {'pair': {'a': {'name': 'Maseki Gourmet Mamono no Chikara wo Tabeta Ore wa Saikyou'}, 'b': {'name': 'Maseki Gurume Mamono no Chikara o Tabeta Ore wa Saikyou!'}}}, '0.9701492537313433': {'pair': {'a': {'name': 'Ore no Ie ga Maryoku Spot datta Ken - Sundeiru dake de Sekai Saikyou'}, 'b': {'name': 'Ore no Ie ga Maryoku Spot Datta Ken Sundeiru dake de Sekai Saikyou'}}}, '0.9620253164556962': {'pair': {'a': {'name': 'Genjitsu Shugi Yuusha no Oukoku Saikenki'}, 'b': {'name': 'Genjitsushugi Yuusha no Oukoku Saikenki'}}}, '0.7096774193548387': {'pair': {'a': {'name': 'Isekai Kenkokuki'}, 'b': {'name': 'Isekai Yakkyoku'}}}, '0.9917355371900827': {'pair': {'a': {'name': 'Zennin Ossan Umarekawattara SSS Rank Jinsei ga Kakutei Shita'}, 'b': {'name': 'Zennin Ossan, Umarekawattara SSS Rank Jinsei ga Kakutei Shita'}}}, '0.9811320754716981': {'pair': {'a': {'name': 'Tou no Kanri o Shite Miyou'}, 'b': {'name': 'Tou no Kanri wo Shite Miyou'}}}, '0.946236559139785': {'pair': {'a': {'name': 'Realist Maou ni Yoru Seiiki Naki Isekai Kaikaku'}, 'b': {'name': 'Realist Maou Niyoru Seiiki Naki Isekai Kaikaku'}}}, '0.9': {'pair': {'a': {'name': 'Tensei Shichatta yo Iya Gomen'}, 'b': {'name': 'Tenseishichatta yo (Iya, Gomen)'}}}, '0.8709677419354839': {'pair': {'a': {'name': 'Tensei Shita Akuyaku Reijou wa Fukushuu wo Nozomanai THE COMIC'}, 'b': {'name': 'Tensei shita Akuyaku Reijou wa Fukushuu wo Nozomanai the Comic'}}}, '0.7246376811594203': {'pair': {'a': {'name': 'Tensei Shitara Ken Deshita'}, 'b': {'name': 'Tensei Shitara Warui Kuni no Musume Deshita'}}}, '0.8108108108108109': {'pair': {'a': {'name': 'Tensei Shitara Slime Datta Ken'}, 'b': {'name': 'Tensura Nikki Tensei Shitara Slime Datta Ken'}}}, '0.8909090909090909': {'pair': {'a': {'name': 'Sekai Saikou no Ansatsusha Isekai Kizoku ni Tensei suru'}, 'b': {'name': 'Sekai Saikyou no Assassin, Isekai Kizoku ni Tensei Suru'}}}, '0.912621359223301': {'pair': {'a': {'name': 'Senki to Yobareta Otoko Ouke ni Ansatsu saretara Musume wo Hiroi Issho ni Slow Life wo Hajimeru Innocent Days'}, 'b': {'name': 'Senki to Yobareta Otoko, Ouke ni Ansatsu Saretara Musume wo Hiroi, Issho ni Slow Life wo Hajimeru'}}}, '0.958904109589041': {'pair': {'a': {'name': 'Sensei Ore ni Kamawazu Itte Kudasai'}, 'b': {'name': 'Sensei, Ore ni Kamawazu Itte Kudasai!!'}}}, '0.9565217391304348': {'pair': {'a': {'name': 'Yankee JK KuzuHana-chan'}, 'b': {'name': 'Yankee JK Kuzuhana-chan'}}}, '0.9655172413793104': {'pair': {'a': {'name': 'Yuusha Party ni Kawaii Ko ga Ita no de Kokuhaku Shitemita'}, 'b': {'name': 'Yuusha Party ni Kawaii Ko ga Ita no de, Kokuhaku Shite Mita'}}}, '0.9285714285714286': {'pair': {'a': {'name': 'Knights & Magic'}, 'b': {'name': 'Knights Magic'}}}, '0.7333333333333333': {'pair': {'a': {'name': 'Isekai Shikkaku'}, 'b': {'name': 'Isekai Yakkyoku'}}}, '0.9752066115702479': {'pair': {'a': {'name': 'Maou-sama no Machizukuri Saikyou no Dungeon wa Kindai Toshi'}, 'b': {'name': 'Maou-sama no Machizukuri! ~Saikyou no Dungeon wa Kindai Toshi~'}}}}
    result_calculated = calculate(result)
    # print(json.dumps(result_calculated, sort_keys=True, indent=4))
    for ratio in result_calculated:
        print(f'Pair A: {result_calculated[ratio]["pair"]["a"]}')
        print(f'Pair B: {result_calculated[ratio]["pair"]["b"]}')
        print(f'Choosen name: "{result_calculated[ratio]["pair"]["master"]}"')
        print("\n")
    print(f"Found {len(result_calculated)} possible duplicates")


def is_dir_path(path):
    if os.path.isfile(path):
        return path

    else:
        raise argparse.ArgumentTypeError(f"readable_dir:{path} is not a valid path")


if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("--directory", help="The path to the directory you want to scan.\n "
                                            "(Volume and number are not parsed)",
                        metavar="<path>")
    args = parser.parse_args()
    base_path = args.directory
    top_dirs = os.listdir(base_path)
    os.chdir(args.directory)
    dirs = [folder for folder in top_dirs]

    # os.chdir(args.directory)
    # dirs = []
    # for top_dir in top_dirs:
    #     top_dir_path = Path(base_path, top_dir)
    #     try:
    #         dirs += [folder for folder in os.listdir(Path(os.getcwd(), top_dir_path))]
    #     except NotADirectoryError:
    #         pass
    progressbar = ProgressBar(False, None, len(dirs))
    main(dirs)
